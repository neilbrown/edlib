
# Details of displays

A display pane (I need a better name) handles all of the interaction
with user-interface hardware, including drawing text and images, and
collecting keyboard and mouse input.  It sends input event to its parent
and receives drawing commands from its children.  It is typically placed
close to the root with "lib-input" as its parent - "lib-input" takes
input events and directs them to the appropriate leave.

## Display events

Events generated (messages) by a display pane include "Keystroke",
"Mouse-event", and "pane:refocus".  The display pane can also close or
resize itself, and these changes propagate to children through the
refresh process.

"Keystroke" comes with a string argument identifying the key that was
pressed - key release is not (currently) notified.  The key
identification is a list of substrings that either start with a colon or
a hyphen.  A colon is followed by the name of a key.  A hyphen is
followed by the UTF-8 character(s) generated by the key, or that would
be generated in the absence of the modifiers.

All substrings but that last must be named modifiers, one of "A", "C",
"S", for Alt, Control, and Shift.  The final substring may be literal
characters or a named key, one of "Down", "Up", "Left", "Right", "Home",
"Backspace", "DelLine", InsLine", "Del", "Ins", "Enter", "End", "Next",
"Prior", "Tab", "F1" through "F12", "ESC", "LF", "Delete".

Individual display drivers might extend this list.  For example the
"ncurses" driver will report any unknown key as "Ncurs-" followed by an
octal value.

"Mouse-event" includes a button number (1, 2, 3, or 0 if none), an
action string which is ":Press-" or ":Release-" followed by the button
number, or ":Motion", some modifies (alt, control, shift) as a keys
stroke might have in the second string, the type (1 for press, 2 for
release, 3 for motion) and x,y co-ordinates.

If a "Mouse-event" message for a ":Motion" action returns a result to
say that it wasn't handled, then no more motion events are generated
until the next ":Press" event.

## Drawing Attributes

Display panes must support drawing messages to clear a pane and to
measure and draw text, and may support messages to measure and draw
images.  These commands accept a list of attributes as a string with
comma-separated entries.  Unrecognised attributes are ignored.
Recognised attributes may require a value which will follow the
attribute name after a colon.  Attributes which may be recognised
include:

 - "inverse" - swap foreground and background colours
 - "bold" - use a bold face of the font
 - "nobold" - or don't.
 - "underline" - draw a line underneath any text
 - "nounderline" - disable drawing the underline
 - "fg:COLOUR" - set the foreground colour.  Colours are detailed below
 - "bg:COLOUR" - set the background colour.
 - "family:FAMILY" - choose a font family
 - "large" - make the font about 40% larger than normal
 - "small" - make the font 90% of normal size
 - "NN" - a number will set the font size, when "10" represents normal.
 - "oblique" - choose an oblique style of the font
 - "italic" - choose an italic sytle
 - "small-caps" chosoe a small-caps style
 - "normal" - restore the normal font style

Colours are handled by sending the colour name in a message to
"colour:map".  This can be expected to handle normal colour named (e.g.
"magenta") and HTML-style colours with a hash ("#") followed by 6 hex
digits representing red, green, and blue intensity as pairs.

A colour can be followed by a plus or minus sign then a number from 0 to
99.  A minus sign ("-") causes the brightness of each channel (r, g, b)
to be scaled by the given number as a percentage.  Thus the brightness
is reduced.  "yellow-50" will be half as bright as "yellow".

A plus sign ("+") causes the brightness of each channel to be increased:
the gap between the actual value and full-brightness is reduced by the
percentage.  So "#4080c0+10" will increase the red channel from 64 to
83 (increase of 19), the green channel from 128 to 140 (increase of 12)
and the blue channel from 192 to 198 (increase of 6).  This increases
the saturation of the colour.

### Drawing commands

The 

Draw:clear
Draw:text-size
Draw:text
Draw:image-size
Draw:image

## Display management commands

Display:close
Display:set-noclose
Display:external-viewer
Display:fullscreen
Display:new


all-displays



Text attributes are given as a comma separate list of whatever the relevant "Draw:text"
method understands.  Unrecognised attributes will be ignored, so you can add extras
for your own purposes.
When "num=-1" is used to clear attributes, a string-comparison of the full attribute
string is used, so for example a nounce could be added to ensure a different mapping
doesn't clear your attributes.

The 'emacs' mode uses a 'focus' attribute when highlighting search results to indicate
the primary focus text.  It also provides a "Draw:text" overlay which notices this,
checks if it is being drawn beneath the "search" pop-up, and if so - moves the pop-up.


